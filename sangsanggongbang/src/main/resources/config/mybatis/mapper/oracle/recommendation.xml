<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gr.ssgb.recommendation.model.RecommendationDAO">

	<insert id="insertRecommendation"
		parameterType="recommendationVO">
		<selectKey keyProperty="recoNo" resultType="int" order="BEFORE">
			select RECOMMENDATION_SEQ.nextval from dual
		</selectKey>

		insert into recommendation(reco_no, reco_title, reco_content, flag, group_no)
		values(#{recoNo},#{recoTitle}, #{recoContent}, #{flag}, #{recoNo}) 

	</insert>
 
	<select id="selectAllRecommendation" parameterType="searchVo"
		resultType="recommendationVO">
		select *
		from
		(
		select rownum as RNUM, A.*
		from
		(

		select * from
		recommendation 
		order by group_no desc, sort_No

		)A
		)
		<![CDATA[
		where RNUM>#{firstRecordIndex} 
			and RNUM<=#{firstRecordIndex}+ #{recordCountPerPage}
		]]>
	</select>

	<select id="selectTotalRecord" parameterType="searchVo"
		resultType="int">
		select count(*) from recommendation
	</select>

	<select id="selectByNoRecommendation" parameterType="int"
		resultType="recommendationVO">
		select * from recommendation
		where reco_no=#{recoNo}
	</select>

	<update id="updateRecommendation"
		parameterType="RecommendationVO">
		update recommendation
		set reco_title= #{recoTitle},
		reco_content=#{recoContent}
		where reco_no=#{recoNo}
	</update>

	<delete id="deleteRecommendation" parameterType="int">
		delete
		recommendation where reco_no=#{recoNo}
	</delete>
	<!-- 답변 -->
	<insert id="reply" parameterType="recommendationVo">
 		<selectKey keyProperty="recoNo" resultType="int" order="BEFORE">
			select recommendation_seq.nextval from dual
		</selectKey>
		insert into recommendation(reco_no, reco_title, reco_content, group_No, sort_No, step)
		values(#{recoNo},#{recoTitle}, #{recoContent}, #{groupNo}, #{sortNo}+1, #{step}+1)
 	</insert>

 	<update id="updateSortNo" parameterType="RecommendationVO">
 		update recommendation
		set sort_no=sort_no+1
		where group_no=#{groupNo} and sort_no>#{sortNo}
 	</update>
</mapper>